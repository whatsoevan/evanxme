---
import type { MarkdownInstance } from 'astro';

interface Props {
  folder?: string;
}

interface Frontmatter {
  title: string;
  description?: string;
  pubDate: string;
  author?: string;
  tags?: string[];
}

const { folder = 'posts' } = Astro.props;

// Dynamic path mapping based on folder name
const pathMap: Record<string, () => Promise<any[]>> = {
  'posts': async () => Object.values(await import.meta.glob<MarkdownInstance<Frontmatter>>('../pages/posts/*.md', { eager: true })),
  'szn1': async () => Object.values(await import.meta.glob<MarkdownInstance<Frontmatter>>('../pages/szn1/*.md', { eager: true })),
};

const allPosts = await (pathMap[folder] || pathMap['posts'])();

// Sort posts by date (newest first)
const sortedPosts = allPosts.sort((a, b) => {
  const dateA = new Date(a.frontmatter.pubDate)
  const dateB = new Date(b.frontmatter.pubDate)
  return dateB.getTime() - dateA.getTime()
})

// Format date as YYYY.MM.DD
const formatDate = (dateString: string) => {
  const date = new Date(dateString)
  const year = date.getFullYear()
  const month = String(date.getMonth() + 1).padStart(2, '0')
  const day = String(date.getDate()).padStart(2, '0')
  return `${year}.${month}.${day}`
}

// Generate link path based on folder
const generateLinkPath = (file: string, folder: string) => {
  // Extract filename from the full file path
  const fileName = file.split('/').pop()?.replace('.md', '');
  
  return `/${folder}/${fileName}`;
}
---

<div class="blog-list group prose dark:prose-invert mt-12 z-50">
  {sortedPosts.map((post) => (
    <a href={generateLinkPath(post.file, folder)} class="blog-item group-hover:opacity-30 hover:!opacity-100 transition-opacity duration-200 mb-4 block no-underline">
      <div class="mb-1">
        <div class="flex items-center gap-3">
          <span class="blog-title flex-1 min-w-0">{post.frontmatter.title}</span>
          <div class="blog-separator h-px bg-current opacity-30 flex-[0.8]"></div>
          <time class="blog-date whitespace-nowrap font-light opacity-30 tabular-nums tracking-tighter flex-shrink-0">{formatDate(post.frontmatter.pubDate)}</time>
        </div>
      </div>
      <div class="italic opacity-80 font-thin text-sm">{post.frontmatter.description}</div>
    </a>
  ))}
</div>
